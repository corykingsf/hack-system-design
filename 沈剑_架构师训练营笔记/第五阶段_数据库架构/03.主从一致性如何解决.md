### 方法论：数据库一致性如何解决:数据冗余，一定会引发一致性问题

![](https://raw.githubusercontent.com/corykingsf/hack-system-design-pixel/main/imgSnipaste_2021-06-28_19-59-53.png)


### 情况一：主从数据冗余，主从数据不一致

上游读从库，写主库，主从有延时
当服务发起一个写请求之后，服务有立即发起一个读请求，此时主从同步为完成，就读到了一个脏数据，从而引发主从不一致，如何解决这种情况？通常有三种方案：
#### 方案一：忽略不计，因为主从不一致的时间非常的短，也就几百ms,很多业务允许500ms以内允许读到旧数据




![](https://raw.githubusercontent.com/corykingsf/hack-system-design-pixel/main/imgSnipaste_2021-06-28_20-03-12.png)


![](https://raw.githubusercontent.com/corykingsf/hack-system-design-pixel/main/imgSnipaste_方案二：强制读主2021-06-28_20-03-12.png)


#### 方案二：强制读主，但是这种方案放弃了读写分离，一主多从的分组架构(增加从库提高系统读性能)，放弃了分组架构提升读性能，就必须使用缓存的方式来提升读性能，引入新的问题：缓存与db中数据不一致
![](https://raw.githubusercontent.com/corykingsf/hack-system-design-pixel/main/imgSnipaste_2021-06-28_20-09-38.png)



### 方案三：分为写操作流程和读操作流程，并且需要引入一个缓存来协助

![](https://raw.githubusercontent.com/corykingsf/hack-system-design-pixel/main/imgSnipaste_2021-06-28_20-12-30.png)

