#### 创业初期架构特点；
- (1)单机系统all in one
- (2)程序耦合 all in one
- (3)逻辑核心是CRUD

#### 业务需求决定架构方案，早期的需求是“demo上线，快速迭代”
#### 随着业务越来越复杂，用户量/数据量/并发量越来越高


- 如何快速解决单机资源瓶颈问题？
  - （1）此时最大的成本，是时间陈本
  - （2）能用前解决的系统问题，往往不是问题
  - （3）老板最不愿见到的，是解决一个系统问题，花很长时间（市场和投资人等不起）

#### 老板的需求有没有变化？
- 新的需求
  - 访问的人多的时候，系统能够访问快一点（性能问题）
  - 出现问题的时候，不要全部挂掉(耦合问题)


如何快速解决系统的性能问题？

- 系统特点与bottleneck分析
  - 现象：
    - 人多的时候会卡
    - 压力会导致宕机
  - 瓶颈分析
    - 网路带宽
    - 内存
    - CPU计算
    - 磁盘IO
  - 初步结论
    - All in one导致单机资源成为瓶颈

#### 伪分布式架构：为什么叫伪分布式？ 一个业务集群，但是每一个业务仍然是单点，子系统的性能仍然受到单机资源的限制，无法扩展


## 怎么解决？  反向代理 ！！！
### 架构演进一: 伪分布式, 提升性能
  - 初步具备一定的容错性
  - 数据库有一台扩为多台，file sever挂了，web server不会受影响, db-write挂了，db-read不会受影响

![picture 1](https://i.loli.net/2021/09/25/2zZH8GvUJQDf5FS.png)  


- 三大分离
  - (1) 读写分离  read/write splitting ，可降低数据库压力，快速提升读写性能，将数据库的读写请求分散到不同的数据库机器上，但是引发读写延时新问题
  - (2) 前后端分离  separation of frontend and backend
    - 前台：用户访问的系统
    - 后台：运营访问的系统
  - (3)动静分离 separate static and dynamic content：静态文件和动态站点分离，css/html放在单独的机器上


- 三大分离的架构设计思路：
  - 用最快的速度，增加硬件资源，提升系统性能，增加访问速度
  - 三大分离并不需要大量的系统架构改造

### 什么问题还没得到解决？
- （1）耦合问题：一个子系统挂了，仍然是全站挂
- 主从延时新问题：读写分离只能提升读写性能，无法降低单库数据量

- 如何解决？  业务垂直拆分

### 架构演进二: 垂直拆分(解决耦合问题和业务延时问题)，解耦

- 垂直拆分会随着业务越来越复杂，会持续进行
  - （1）业务垂直拆分
  - （2）代码垂直拆分(子系统解耦)
  - （3）数据库垂直拆分(单库数据量降低，主从延时得到缓解)
  - （4）研发团队拆分(专业化，效率提升)

![picture 2](https://i.loli.net/2021/09/25/zTm1QHVW9tEM5lg.png)  

- 垂直拆分：用最快的速度，增加硬件资源，实现系统的解耦，而且只需要少量的系统改造
- 小结
  - （1）随着流量提升，系统最先遇到的两大问题是
    - 慢，性能下降
    - 一挂全挂，耦合
  - （2）如何快速提升性能：伪分布式，三大分离(读写，动静，前台后台)
  - （3）如何快速解耦：垂直拆分 （业务，代码，数据库，研发团队）
  - （4）垂直拆分：在架构演进的各个阶段，会持续进行
  - （5）早期解决的思路是：增加硬件资源（时间短）， 避免大规模代码重构（时间长）
  - （6）早期最大的成本是时间成本：能用钱解决的系统问题往往不是问题


### 架构演进三: 伪分布式，垂直拆分
  - 潜在的问题，子系统仍是单体架构
    - （1）子系统的性能，收到单台机器资源限制，不能扩展
    - （2）子系统，不高可用（伪集群）
    - 解决方案：reverse proxy
      - (1)子系统集群化：可以多机扩展
      - （2）子系统高可用(伪集群 --> 真集群)

![picture 3](https://i.loli.net/2021/09/25/eSVz5mERGXKIq1v.png)  
