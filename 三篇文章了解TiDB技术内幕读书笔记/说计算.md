### 三篇文章了解 TiDB 技术内幕 - 说计算

#### 如何将关系模型映射到key-value模型：

* 这里对应关系模型的表结构：
* 1.metadata 
* 2. row  (TidB的首要目标是OLTP, OLTP的use case需要支持快速的读取，保存,修改，删除一行的数据，所以用行存比较合适)
* 3 index (TiDB需要支持primary index and secondary index)  //为什么要用index? 提高查询性能，以及保证某些constraint

(查询的两种模式： 1. 点查(通过primary key or unique key的等值条件查询: select name from user where id=1,用于快速定位到一行数据)) 2.range查询


### 考虑insert/update/delete/select:
* 1.insert:  将row写入kv,并且建立好index
* 2.update: 将row更新的同时，更新index(if needed)
* 3. delete: 删除row的同时也删除索引
* 4. select: each row has ID, might read multiple rows/might use index 



table --> tabbleID (整个集群内唯一)
index --> indexID  (表内唯一)
row --> RowID(如果表有整数型primary key,那么会用primary key的值当做RowID)  (表内唯一)


each row is represented by  key-value pairs:
```
Key: tablePrefix{tableID}_recordPrefixSep{rowID}
Value: [col1, col2, col3, col4]
```

#### 元信息管理

### TiDB整体架构

### SQL运算



###  分布式SQL运算









### SQL层架构

Ref: https://pingcap.com/zh/blog/tidb-internal-2